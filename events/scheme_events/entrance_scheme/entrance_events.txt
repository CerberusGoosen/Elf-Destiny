namespace = entrance

# scope:recipient = {
# 	invite_to_activity = scope:actor.involved_activity
# }

# accept_activity_invite = scope:activity
# decline_activity_invite = scope:activity

# Controller
entrance.101 = {
	hidden = yes
	
	immediate = {
		if = { # Foreign Lord
			limit = {
				scope:victim = {
					is_landed = yes
					NOR = {
						is_liege_or_above_of = scope:entrancer
						is_vassal_or_below_of = scope:entrancer
					}
				}
			}

			trigger_event = entrance.102
		}

		else_if = { # Liege
			limit = {
				scope:victim = {
					is_liege_or_above_of = scope:entrancer
				}
			}

			trigger_event = entrance.102
		}

		else_if = { # Vassal
			limit = {
				scope:victim = {
					is_vassal_of = scope:entrancer
				}
			}

			trigger_event = entrance.102
		}

		else_if = { # Courtier
			limit = {
				scope:victim = {
					is_courtier_of = scope:entrancer
				}
			}

			trigger_event = entrance.103
		}

		#TODO: flush this out more
		else = { # Unlanded
			trigger_event = entrance.103
		}
	}
}

# Foreign Lord
entrance.102 = {
	type = character_event
	title = entrance.102.title
	desc = entrance.102.desc
	theme = seduce_scheme

	left_portrait = scope:victim
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	# Attend Foreign Lords Feast
	option = {
		name = entrance.102.attend_feast

		scope:victim = {
			add_character_flag = hold_feast_now
			# add_character_modifier = {
			# 	modifier = planning_feast
			# 	years = 10
			# }
			set_variable = {
				name = entrancer
				value = scope:entrancer
			}
			hidden_effect = {
				add_gold = 200
			}
		}
	}

	# Hold Feast Yourself
	option = {
		name = entrance.102.hold_feast

		root = {
			set_variable = {
				name = victim
				value = scope:victim
			}
		}
	}
}

# Recieve invitation
entrance.1021 = {
	type = letter_event
	opening = entrance.1021.title
	desc = entrance.1021.desc
	sender = scope:victim

	immediate = {
		scope:host ?= {
			save_scope_as = victim
		}
	}

	option = {
		name = entrance.1021.ok

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			add_scheme_progress = 3
		}
		
		add_to_activity = scope:victim.involved_activity
	}
}

# Entrance Feast Event - Attempt Entrance Plant Seed?
entrance.1022 = {
	type = activity_event
	title = entrance.1022.title
	desc = entrance.1022.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:victim
		animation = admiration
	}

	trigger = {
		# this = scope:activity.special_guest:entrancer_or_victim
			# 	# scope:goh = {
		# 	# 	is_alive = yes
		# 	# 	involved_activity ?= scope:activity
		# 	# }
	}

	immediate = {
		debug_log = "MADE IT TO FIRST EVENT"
		debug_log_scopes = yes
	}

	option = { # Attempt Entrance
		name = entrance.1022.a
		flavor = entrance_modifiers_desc

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:victim
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:victim
			}
		}

		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			trigger_event = entrance.1023
		}
		else = {
			trigger_event = entrance.1024
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance.1022.b
		# flavor = entrance_flavor # but different!
		if = {
			limit = {
				exists = scope:victim
			}
			random_scheme = {
				limit = {
					scheme_type = entrance
					scheme_target = scope:victim
				}
				end_scheme = yes
			}
		}
	}
}

# Entrance Feast Event - Plant Entrance Seed Success
entrance.1023 = {
	type = activity_event
	title = entrance.1023.title
	desc = entrance.1023.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:victim
		animation = disbelief
	}

	option = { 
		name = entrance.1023.a
	}
}

# Entrance Feast Event - Plant Entrance Seed Fail
entrance.1024 = {
	type = activity_event
	title = entrance.1024.title
	desc = entrance.1024.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:victim
		animation = dismissal
	}

	immediate = {
		scope:victim = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}
	}

	option = { 
		name = entrance.1024.a
	}
}

# Entrance Feast Event - Complete Entrance Effect
entrance.1025 = {
	type = activity_event
	title = entrance.1025.title
	desc = entrance.1025.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:victim
		animation = admiration
	}

	trigger = {

	}

	option = { # Attempt Entrance
		name = entrance.1025.a
		# flavor = entrance_flavor
		flavor = entrance_modifiers_desc
		# custom_label

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:victim
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:victim
			}
		}

		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			trigger_event = entrance.1026
		}
		else = {
			trigger_event = entrance.1027
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance.1025.b
		# flavor = feast.7201.b.tt # leave to test! wtf is this lol

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}
}

# Entrance Feast Event - Entrance was successful!
entrance.1026 = {
	type = activity_event
	title = entrance.1026.title
	desc = entrance.1026.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:victim
		animation = disbelief
	}

	immediate = {
		add_hook = {
			target = scope:victim
			type = entranced
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance.1026.just_hook
	}
}

# Entrance Feast Event - Entrance failed
entrance.1027 = {
	type = activity_event
	title = entrance.1027.title
	desc = entrance.1027.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:victim
		animation = dismissal
	}

	immediate = {
		scope:victim = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance.1027.a
	}
}


# Own Holding
entrance.103 = {
	type = character_event
	title = entrance.103.title
	desc = entrance.103.desc
	theme = seduce_scheme

	left_portrait = scope:victim
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	# Hold Feast
	option = {
		name = entrance.103.hold_feast
	}

	# Approach them around your holding
	option = {
		name = entrance.103.around_holding
		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			add_scheme_progress = 3
			set_variable = {
				name = entrance_in_holding
				value = yes
			}
		}
	}
}

# Own Holding - Plant the seed attempt
entrance.1031 = { 
	type = character_event
	title = entrance.1031.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:victim = {
						is_spouse_of = scope:entrancer
					}
				}
				desc = entrance.1031.intro.spouse
			}
			triggered_desc = {
				trigger = {
					scope:victim = {
						is_close_family_of = scope:entrancer
					}
				}
				desc = entrance.1031.intro.close_family
			}
			desc = entrance.1031.intro.standard
		}
		desc = entrance.1031.desc
	}
	
	theme = seduce_scheme

	left_portrait = scope:victim
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	option = { # Attempt Entrance
		name = entrance.1031.a
		flavor = entrance_modifiers_desc

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:victim
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:victim
			}
		}

		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			trigger_event = entrance.1032
		}
		else = {
			trigger_event = entrance.1033
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance.1031.b
		if = {
			limit = {
				exists = scope:victim
			}
			random_scheme = {
				limit = {
					scheme_type = entrance
					scheme_target = scope:victim
				}
				end_scheme = yes
			}
		}
	}
}

# Own Holding - Plant Entrance Seed Success
entrance.1032 = {
	type = character_event
	title = entrance.1032.title
	desc = entrance.1032.desc
	theme = seduce_scheme
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:victim
		animation = disbelief
	}

	option = { 
		name = entrance.1032.a
	}
}

# Own Holding - Plant Entrance Seed Fail
entrance.1033 = {
	type = character_event
	title = entrance.1033.title
	desc = entrance.1033.desc
	theme = seduce_scheme
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:victim
		animation = dismissal
	}

	immediate = {
		scope:victim = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}
	}

	option = { 
		name = entrance.1033.a
	}
}

# Own Holding - Complete Entrance
entrance.1034 = {
	type = character_event
	title = entrance.1034.title
	desc = entrance.1034.desc
	theme = seduce_scheme
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:victim
		animation = admiration
	}

	trigger = {

	}

	option = { # Attempt Entrance
		name = entrance.1034.a
		flavor = entrance_modifiers_desc

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:victim
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:victim
			}
		}

		debug_log = "final entrance"
		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			debug_log = "final entrance yes"
			trigger_event = entrance.1035
		}
		else = {
			debug_log = "final entrance no"
			trigger_event = entrance.1036
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance.1034.b

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}
}

# Own Holding - Entrance was successful!
entrance.1035 = {
	type = character_event
	title = entrance.1035.title
	desc = entrance.1035.desc
	theme = seduce_scheme
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:victim
		animation = disbelief
	}

	immediate = {
		add_hook = {
			target = scope:victim
			type = entranced
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance.1035.just_hook
	}
}

# Own Holding - Entrance failed
entrance.1036 = {
	type = character_event
	title = entrance.1035.title
	desc = entrance.1035.desc
	theme = seduce_scheme
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:victim
		animation = dismissal
	}

	immediate = {
		scope:victim = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance.1024.a
	}
}


# HOSTING ENTRANCE FEAST

entrance.1141 = {
	hidden = yes
	
	immediate = {
		add_to_activity = scope:host.involved_activity

		root = {
			save_scope_as = victim
		}
		scope:host = {
			trigger_event = entrance.1041
		}
	}
}

# Recieve invitation Acceptance
entrance.1041 = {
	type = letter_event
	opening = entrance.1041.title
	desc = entrance.1041.desc
	sender = scope:victim

	immediate = {
	}

	option = {
		name = entrance.1041.ok

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			add_scheme_progress = 3
		}
		
		add_to_activity = scope:victim.involved_activity
	}
}

# HOSTING Entrance Feast Event - Attempt Entrance Plant Seed?
entrance.1042 = {
	type = activity_event
	title = entrance.1042.title
	desc = entrance.1042.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:victim
		animation = admiration
	}

	trigger = {
		# this = scope:activity.special_guest:entrancer_or_victim
			# 	# scope:goh = {
		# 	# 	is_alive = yes
		# 	# 	involved_activity ?= scope:activity
		# 	# }
	}

	immediate = {
		debug_log = "MADE IT TO FIRST EVENT 42"
		debug_log_scopes = yes
	}

	option = { # Attempt Entrance
		name = entrance.1042.a
		flavor = entrance_modifiers_desc

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:victim
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:victim
			}
		}

		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			trigger_event = entrance.1043
		}
		else = {
			trigger_event = entrance.1044
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance.1042.b
		# flavor = entrance_flavor # but different!
		if = {
			limit = {
				exists = scope:victim
			}
			random_scheme = {
				limit = {
					scheme_type = entrance
					scheme_target = scope:victim
				}
				end_scheme = yes
			}
		}
	}
}

# HOSTING Entrance Feast Event - Plant Entrance Seed Success
entrance.1043 = {
	type = activity_event
	title = entrance.1043.title
	desc = entrance.1043.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:victim
		animation = disbelief
	}

	option = { 
		name = entrance.1043.a
	}
}

# HOSTING Entrance Feast Event - Plant Entrance Seed Fail
entrance.1044 = {
	type = activity_event
	title = entrance.1044.title
	desc = entrance.1044.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:victim
		animation = dismissal
	}

	immediate = {
		scope:victim = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}
	}

	option = { 
		name = entrance.1044.a
	}
}

# HOSTING Entrance Feast Event - Complete Entrance Effect
entrance.1045 = {
	type = activity_event
	title = entrance.1045.title
	desc = entrance.1045.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:victim
		animation = admiration
	}

	trigger = {

	}

	option = { # Attempt Entrance
		name = entrance.1045.a
		# flavor = entrance_flavor
		flavor = entrance_modifiers_desc
		# custom_label

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:victim
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:victim
			}
		}

		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			trigger_event = entrance.1046
		}
		else = {
			trigger_event = entrance.1047
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance.1045.b
		# flavor = feast.7201.b.tt # leave to test! wtf is this lol

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}
}

# HOSTING Entrance Feast Event - Entrance was successful!
entrance.1046 = {
	type = activity_event
	title = entrance.1046.title
	desc = entrance.1046.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:victim
		animation = disbelief
	}

	immediate = {
		add_hook = {
			target = scope:victim
			type = entranced
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance.1046.just_hook
	}
}

# HOSTING Entrance Feast Event - Entrance failed
entrance.1047 = {
	type = activity_event
	title = entrance.1047.title
	desc = entrance.1047.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:victim
		animation = dismissal
	}

	immediate = {
		scope:victim = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:victim
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance.1047.a
	}
}




entrance.1100 = { # Convert to Enthralled
	type = character_event
	title = entrance.1100.title
	desc = entrance.1100.desc

	theme = seduction
	left_portrait = {
		character = scope:target
		animation = disbelief
	}
	right_portrait = {
		character = root
		animation = flirtation
	}

	immediate = {
		if = {
			limit = {
				exists = scope:target
			}
			scope:target = {
				remove_trait = entranced
				add_trait = enthralled
			}
			remove_hook = {
				target = scope:target
			}
			add_hook = {
				type = enthralled
				target = scope:target
			}
		}
	}

	option = {
		name = entrance.1100.a
	}
}