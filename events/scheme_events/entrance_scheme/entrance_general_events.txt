namespace = entrance_general

# scope:recipient = {
# 	invite_to_activity = scope:actor.involved_activity
# }

# accept_activity_invite = scope:activity
# decline_activity_invite = scope:activity

# Controller
entrance_general.101 = {
	hidden = yes
	
	immediate = {
		if = { # Foreign Lord
			limit = {
				scope:target = {
					is_landed = yes
					NOR = {
						is_liege_or_above_of = scope:owner
						is_vassal_or_below_of = scope:owner
					}
				}
			}

			trigger_event = entrance_general.102
		}

		# else_if = { # Liege
		# 	limit = {
		# 		scope:target = {
		# 			is_liege_or_above_of = scope:owner
		# 		}
		# 	}

		# 	trigger_event = entrance_general.1003
		# }

		# else_if = { # Vassal
		# 	limit = {
		# 		scope:target = {
		# 			is_vassal_of = scope:owner
		# 		}
		# 	}

		# 	trigger_event = entrance_general.1004
		# }

		# else_if = { # Courtier
		# 	limit = {
		# 		scope:target = {
		# 			is_courtier_of = scope:owner
		# 		}
		# 	}

		# 	trigger_event = entrance_general.1005
		# }

		# else = { # Unlanded
		# 	trigger_event = entrance_general.1006
		# }
	}
}

# Foreign Lord
entrance_general.102 = {
	type = character_event
	title = entrance_general.102.title
	desc = entrance_general.102.desc
	theme = seduce_scheme

	left_portrait = scope:target
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	# Attend Foreign Lords Feast
	option = {
		name = entrance_general.102.attend_feast

		scope:target = {
			add_character_flag = hold_feast_now
			set_variable = {
				name = entrancer
				value = scope:owner
			}
		}
	}

	# Hold Feast Yourself
	option = {
		name = entrance_general.102.hold_feast
	}
}

# Recieve invitation
entrance_general.1021 = {
	type = letter_event
	opening = entrance_general.1021.title
	desc = entrance_general.1021.desc
	sender = scope:host

	immediate = {
	}

	option = {
		name = entrance_general.1021.ok

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:host
			}
			add_scheme_progress = 3
		}
		
		add_to_activity = scope:host.involved_activity
	}
}

# Entrance Feast Event - Attempt Entrance Plant Seed?
entrance_general.1022 = {
	type = activity_event
	title = entrance_general.1022.title
	desc = entrance_general.1022.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:host
		animation = admiration
	}

	trigger = {
		# this = scope:activity.special_guest:entrancer
			# 	# scope:goh = {
		# 	# 	is_alive = yes
		# 	# 	involved_activity ?= scope:activity
		# 	# }
	}

	immediate = {
		debug_log = "MADE IT TO FIRST EVENT"
		debug_log_scopes = yes
	}

	option = { # Attempt Entrance
		name = entrance_general.1022.a
		flavor = {
			# Difference in Elf Level
			desc = entrance_attempt_modifiers
			triggered_desc = { ## +
				trigger = { 
					entrance_difference_in_elf_level >= 1
					entrance_difference_in_elf_level < 3
				}
				desc = entrance_difference_in_elf_level.small_boost
			}
			triggered_desc = { ## ++
				trigger = { 
					entrance_difference_in_elf_level >= 3
					entrance_difference_in_elf_level < 5
				}
				desc = entrance_difference_in_elf_level.big_boost
			}
			triggered_desc = { ## +++
				trigger = { 
					entrance_difference_in_elf_level >= 5
				}
				desc = entrance_difference_in_elf_level.massive_boost
			}
			triggered_desc = { ## -
				trigger = { 
					entrance_difference_in_elf_level <= -1
					entrance_difference_in_elf_level > -3
				}
				desc = entrance_difference_in_elf_level.small_penalty
			}
			triggered_desc = { ## --
				trigger = { 
					entrance_difference_in_elf_level <= -3
					entrance_difference_in_elf_level > -5
				}
				desc = entrance_difference_in_elf_level.big_penalty
			}
			triggered_desc = { ## ---
				trigger = { 
					entrance_difference_in_elf_level <= -5
				}
				desc = entrance_difference_in_elf_level.massive_penalty
			}
		
			# Difference in Spark Manipulation
			triggered_desc = { ## +
				trigger = { 
					entrance_difference_in_magic_talent = 1
				}
				desc = entrance_difference_in_magic_talent.small_boost
			}
			triggered_desc = { ## ++
				trigger = { 
					entrance_difference_in_magic_talent = 2
				}
				desc = entrance_difference_in_magic_talent.big_boost
			}
			triggered_desc = { ## +++
				trigger = { 
					entrance_difference_in_magic_talent >= 3
				}
				desc = entrance_difference_in_magic_talent.massive_boost
			}
			triggered_desc = { ## -
				trigger = { 
					entrance_difference_in_magic_talent = -1
				}
				desc = entrance_difference_in_magic_talent.small_penalty
			}
			triggered_desc = { ## --
				trigger = { 
					entrance_difference_in_magic_talent = -2
				}
				desc = entrance_difference_in_magic_talent.big_penalty
			}
			triggered_desc = { ## ---
				trigger = { 
					entrance_difference_in_magic_talent <= -3
				}
				desc = entrance_difference_in_magic_talent.massive_penalty
			}
		
			# Enchantress Bonus
			triggered_desc = {
				trigger = {
					scope:entrancer = {
						has_trait = enchantress
					}
					NOT = {
						scope:victim = {
							has_trait = enchantress
						}
					}
				}
		
				desc = entrance_entrancer_is_enchantress
			}
			triggered_desc = {
				trigger = {
					NOT = {
						scope:entrancer = {
							has_trait = enchantress
						}
					}
		
					scope:victim = {
						has_trait = enchantress
					}
				}
		
				desc = entrance_victim_is_enchantress
			}
			
		}

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:host
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:host
			}
		}

		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			trigger_event = entrance_general.1023
		}
		else = {
			trigger_event = entrance_general.1024
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance_general.1022.b
		# flavor = entrance_flavor # but different!
		if = {
			limit = {
				exists = scope:host
			}
			random_scheme = {
				limit = {
					scheme_type = entrance
					scheme_target = scope:host
				}
				end_scheme = yes
			}
		}
	}
}

# Entrance Feast Event - Plant Entrance Seed Success
entrance_general.1023 = {
	type = activity_event
	title = entrance_general.1023.title
	desc = entrance_general.1023.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:host
		animation = disbelief
	}

	option = { 
		name = entrance_general.1023.a
	}
}

# Entrance Feast Event - Plant Entrance Seed Fail
entrance_general.1024 = {
	type = activity_event
	title = entrance_general.1024.title
	desc = entrance_general.1024.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:host
		animation = dismissal
	}

	immediate = {
		scope:host = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}
	}

	option = { 
		name = entrance_general.1024.a
	}
}

# Entrance Feast Event - Complete Entrance Effect
entrance_general.1025 = {
	type = activity_event
	title = entrance_general.1025.title
	desc = entrance_general.1025.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = happiness
	}
	right_portrait = {
		character = scope:host
		animation = admiration
	}

	trigger = {

	}

	option = { # Attempt Entrance
		name = entrance_general.1025.a
		# flavor = entrance_flavor
		flavor = {
			# Difference in Elf Level
			desc = entrance_attempt_modifiers
			triggered_desc = { ## +
				trigger = { 
					entrance_difference_in_elf_level >= 1
					entrance_difference_in_elf_level < 3
				}
				desc = entrance_difference_in_elf_level.small_boost
			}
			triggered_desc = { ## ++
				trigger = { 
					entrance_difference_in_elf_level >= 3
					entrance_difference_in_elf_level < 5
				}
				desc = entrance_difference_in_elf_level.big_boost
			}
			triggered_desc = { ## +++
				trigger = { 
					entrance_difference_in_elf_level >= 5
				}
				desc = entrance_difference_in_elf_level.massive_boost
			}
			triggered_desc = { ## -
				trigger = { 
					entrance_difference_in_elf_level <= -1
					entrance_difference_in_elf_level > -3
				}
				desc = entrance_difference_in_elf_level.small_penalty
			}
			triggered_desc = { ## --
				trigger = { 
					entrance_difference_in_elf_level <= -3
					entrance_difference_in_elf_level > -5
				}
				desc = entrance_difference_in_elf_level.big_penalty
			}
			triggered_desc = { ## ---
				trigger = { 
					entrance_difference_in_elf_level <= -5
				}
				desc = entrance_difference_in_elf_level.massive_penalty
			}
		
			# Difference in Spark Manipulation
			triggered_desc = { ## +
				trigger = { 
					entrance_difference_in_magic_talent = 1
				}
				desc = entrance_difference_in_magic_talent.small_boost
			}
			triggered_desc = { ## ++
				trigger = { 
					entrance_difference_in_magic_talent = 2
				}
				desc = entrance_difference_in_magic_talent.big_boost
			}
			triggered_desc = { ## +++
				trigger = { 
					entrance_difference_in_magic_talent >= 3
				}
				desc = entrance_difference_in_magic_talent.massive_boost
			}
			triggered_desc = { ## -
				trigger = { 
					entrance_difference_in_magic_talent = -1
				}
				desc = entrance_difference_in_magic_talent.small_penalty
			}
			triggered_desc = { ## --
				trigger = { 
					entrance_difference_in_magic_talent = -2
				}
				desc = entrance_difference_in_magic_talent.big_penalty
			}
			triggered_desc = { ## ---
				trigger = { 
					entrance_difference_in_magic_talent <= -3
				}
				desc = entrance_difference_in_magic_talent.massive_penalty
			}

			# Magi Bonus
			triggered_desc = {
				trigger = {
					scope:entrancer = {
						has_trait = magi
					}
					NOT = {
						scope:victim = {
							has_trait = magi
						}
					}
				}
		
				desc = entrance_entrancer_is_magi
			}
			triggered_desc = {
				trigger = {
					NOT = {
						scope:entrancer = {
							has_trait = magi
						}
					}
		
					scope:victim = {
						has_trait = magi
					}
				}
		
				desc = entrance_victim_is_magi
			}

			# Enchantress Bonus
			triggered_desc = {
				trigger = {
					scope:entrancer = {
						has_trait = enchantress
					}
					NOT = {
						scope:victim = {
							has_trait = enchantress
						}
					}
				}
		
				desc = entrance_entrancer_is_enchantress
			}
			triggered_desc = {
				trigger = {
					NOT = {
						scope:entrancer = {
							has_trait = enchantress
						}
					}
		
					scope:victim = {
						has_trait = enchantress
					}
				}
		
				desc = entrance_victim_is_enchantress
			}
			
			triggered_desc = {
				trigger = {
					NOT = {
						scope:entrancer = {
							has_trait = enchantress
						}
						scope:victim = {
							has_trait = enchantress
						}
					}
				}
				desc = spacer
			}
		}
		# custom_label

		if = {
			limit = {
				AND = {
					exists = root
					exists = scope:host
				}
			}
			
			attempt_to_entrance_character_effect = {
				ENTRANCER = root
				VICTIM = scope:host
			}
		}

		if = {
			limit = {
				exists = scope:entrance_successful
				scope:entrance_successful = yes
			}
			trigger_event = entrance_general.1026
		}
		else = {
			trigger_event = entrance_general.1027
		}
	}
	
	option = { # Nevermind abandon scheme
		name = entrance_general.1025.b
		# flavor = feast.7201.b.tt # leave to test! wtf is this lol

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:host
			}
			end_scheme = yes
		}
	}
}

# Entrance Feast Event - Entrance was successful!
entrance_general.1026 = {
	type = activity_event
	title = entrance_general.1026.title
	desc = entrance_general.1026.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:host
		animation = disbelief
	}

	immediate = {
		add_hook = {
			target = scope:host
			type = entranced
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:host
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance_general.1026.just_hook
	}

	option = { 
		name = entrance_general.1026.sleep_with

		set_relation_lover = { 
			reason = ensnared_in_entrancement
			target = scope:host
			province = scope:activity.activity_province
		}
		had_sex_with_effect = { CHARACTER = scope:host PREGNANCY_CHANCE = 50 }
	}
}

# Entrance Feast Event - Entrance failed
entrance_general.1027 = {
	type = activity_event
	title = entrance_general.1027.title
	desc = entrance_general.1027.desc
	theme = feast_activity
	left_portrait = {
		# scope:activity.special_guest:honorary_guest
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:host
		animation = dismissal
	}

	immediate = {
		scope:host = {
			set_relation_rival = {
				target = root
				reason = tried_to_entrance_me
			}
		}

		random_scheme = {
			limit = {
				scheme_type = entrance
				scheme_target = scope:host
			}
			end_scheme = yes
		}
	}

	option = { 
		name = entrance_general.1024.a
	}
}

entrance_general.1100 = { # Convert to Enthralled
	type = character_event
	title = entrance_general.1100.title
	desc = entrance_general.1100.desc

	theme = seduction
	left_portrait = {
		character = scope:target
		animation = disbelief
	}
	right_portrait = {
		character = root
		animation = flirtation
	}

	immediate = {
		if = {
			limit = {
				exists = scope:target
			}

			scope:target = {
				remove_trait = entranced
				add_trait = enthralled
			}
		}
	}

	option = {
		name = entrance_general.1100.a
	}
}